# Ansible 介绍



## 运维自动化发展历程及技术应用

![image](https://note.youdao.com/yws/public/resource/8c63ba60a1fe9493ff39e11278730dc7/6F5B086A36464AF29DC98BEED570F3C1?ynotemdtimestamp=1616630466407)

## 企业实际应用场景分析

```tex
Dev开发环境
    使用者：程序员
    功能：程序员开发软件，测试BUG的环境
    管理者：程序员

测试环境    
    使用者：QA测试工程师
    功能：测试经过Dev环境测试通过的软件的功能
    管理者：运维

说明：测试环境往往有多套,测试环境满足测试功能即可，不宜过多
1、测试人员希望测试环境有多套,公司的产品多产品线并发，即多个版本，意味着多个版本同步测试
2、通常测试环境有多少套和产品线数量保持一样

发布环境：代码发布机，有些公司为堡垒机（安全屏障）
    使用者：运维
    功能：发布代码至生产环境
    管理者：运维（有经验）
    发布机：往往需要有2台（主备）

生产环境
    使用者：运维，少数情况开放权限给核心开发人员，极少数公司将权限完全
    开放给开发人员并其维护
    功能：对用户提供公司产品的服务

管理者：只能是运维
    生产环境服务器数量：一般比较多，且应用非常重要。往往需要自动工具协助部署配置应用

灰度环境（生产环境的一部分）
    使用者：运维
    功能：在全量发布代码前将代码的功能面向少量精准用户发布的环境,可基
    于主机或用户执行灰度发布
    案例：共100台生产服务器，先发布其中的10台服务器，这10台服务器就是灰度服务器
    管理者：运维
    灰度环境：往往该版本功能变更较大，为保险起见特意先让一部分用户优化体验该功能，
              待这部分用户使用没有重大问题的时候，再全量发布至所有服务器
```



## 程序发布

```tex
程序发布要求：
    不能导致系统故障或造成系统完全不可用
    不能影响用户体验
预发布验证：
    新版本的代码先发布到服务器（跟线上环境配置完全相同，只是未接入到调度器）
灰度发布：
    基于主机，用户，业务
发布路径：
    /webapp/tuangou
    /webapp/tuangou-1.1
    /webapp/tuangou-1.2
发布过程：在调度器上下线一批主机(标记为maintanance状态) --> 关闭服务 -->
          部署新版本的应用程序 --> 启动服务 --> 在调度器上启用这一批服务器
自动化灰度发布：脚本、发布平台
```



## 运维自动化发展历程及技术应用

![image](https://note.youdao.com/yws/public/resource/8c63ba60a1fe9493ff39e11278730dc7/E8D4C3F76C214F7EA908F5AD59218D32?ynotemdtimestamp=1616630466407)

## 自动化运维应用场景

```tex
文件传输
应用部署
配置管理
任务流编排
```



## 常用自动化运维工具

```tex
Ansible：python，Agentless，中小型应用环境
Saltstack：python，一般需部署agent，执行效率更高
Puppet：ruby, 功能强大，配置复杂，重型,适合大型环境
Fabric：python，agentless
Chef：ruby，国内应用少
Cfengine
func
```



## 企业级自动化运维工具应用实战ansible

```tex
公司计划在年底做一次大型市场促销活动，全面冲刺下交易额，为明年的上市做准备。
公司要求各业务组对年底大促做准备，运维部要求所有业务容量进行三倍的扩容，
并搭建出多套环境可以共开发和测试人员做测试，运维老大为了在年底有所表现，
要求运维部门同学尽快实现，当你接到这个任务时，有没有更快的解决方案？
```



## Ansible发展史

```tex
Ansible
Michael DeHaan（ Cobbler 与 Func 作者）
名称来自《安德的游戏》中跨越时空的即时通信工具
2012-03-09，发布0.0.1版，2015-10-17，Red Hat宣布收购
官网：https://www.ansible.com/
官方文档：https://docs.ansible.com/
同类自动化工具GitHub关注程度（2016-07-10）
```

![image](https://note.youdao.com/yws/public/resource/8c63ba60a1fe9493ff39e11278730dc7/D651B3E163FC4316970259344AA207AB?ynotemdtimestamp=1616630466407)



## 特性

>1> **模块化**：调用特定的模块，完成特定任务
>2> **Paramiko（python对ssh的实现），PyYAML，Jinja2（模板语言）**三个关键模块
>3> 支持**自定义模块**
>4> 基于**Python**语言实现
>5> **部署简单**，基于python和SSH(默认已安装)，agentless
>6> 安全，基于OpenSSH
>7> 支持**playbook编排任务**
>8> **幂等性**：一个任务执行1遍和执行n遍效果一样，不因重复执行带来意外情况
>9> **无需代理**不依赖PKI（无需ssl）
>10> 可使用任何编程语言写模块
>11> **YAML**格式，编排任务，支持丰富的数据结构
>12> 较强大的多层解决方案